"use strict";(()=>{var e={};e.id=8044,e.ids=[8044],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},89170:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>A,patchFetch:()=>S,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>P,staticGenerationBailout:()=>v});var o={};r.r(o),r.d(o,{POST:()=>f});var a=r(10884),n=r(16132),s=r(21040),i=r(95798),l=r(6113),u=r.n(l);let p=process.env.PAYFAST_MERCHANT_ID||"10000100";process.env.PAYFAST_MERCHANT_KEY;let c=process.env.PAYFAST_PASSPHRASE||"jt7NOE43FZPn",d=(e,t="")=>{let r="";for(let t in e)e.hasOwnProperty(t)&&""!==e[t]&&(r+=`${t}=${encodeURIComponent(e[t].toString().trim()).replace(/%20/g,"+")}&`);return r=r.slice(0,-1),""!==t&&(r+=`&passphrase=${encodeURIComponent(t.trim()).replace(/%20/g,"+")}`),u().createHash("md5").update(r).digest("hex")};async function f(e){try{let t=await e.formData(),r={},o=Array.from(t.entries());for(let[e,t]of o)r[e]=t.toString();console.log("PayFast notification received:",r);let a=r.signature;delete r.signature;let n=d(r,c);if(a!==n)return console.error("Invalid signature from PayFast"),i.Z.json({error:"Invalid signature"},{status:400});if(r.merchant_id!==p)return console.error("Invalid merchant ID"),i.Z.json({error:"Invalid merchant"},{status:400});let s=r.payment_status,l=r.m_payment_id;return console.log(`Payment ${l} status: ${s}`),"COMPLETE"===s?console.log(`Payment completed for order ${l}`):"FAILED"===s?console.log(`Payment failed for order ${l}`):"CANCELLED"===s&&console.log(`Payment cancelled for order ${l}`),i.Z.json({status:"OK"})}catch(e){return console.error("PayFast notification error:",e),i.Z.json({error:"Server error"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/payfast/notify/route",pathname:"/api/payfast/notify",filename:"route",bundlePath:"app/api/payfast/notify/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/payfast/notify/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:P,serverHooks:g,headerHooks:h,staticGenerationBailout:v}=m,A="/api/payfast/notify/route";function S(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:P})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[3271,8107],()=>r(89170));module.exports=o})();