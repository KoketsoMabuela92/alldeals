"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},54128:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>w,originalPathname:()=>q,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>x});var a={};t.r(a),t.d(a,{POST:()=>m});var s=t(10884),i=t(16132),o=t(21040),n=t(95798),u=t(15204),l=t(62421),d=t.n(l),p=t(96721),c=t.n(p);async function m(e){try{let r=await e.json(),{email:t,password:a}=r;if(!t||!a)return n.Z.json({error:"Email and password are required"},{status:400});let s=await u._.user.findUnique({where:{email:t},select:{id:!0,email:!0,password:!0,name:!0,firstName:!0,lastName:!0,phone:!0,address:!0,city:!0,country:!0,isActive:!0,createdAt:!0}});if(!s)return n.Z.json({error:"Invalid credentials"},{status:401});if(!s.isActive)return n.Z.json({error:"Account is deactivated"},{status:401});let i=await d().compare(a,s.password);if(!i)return n.Z.json({error:"Invalid credentials"},{status:401});await u._.user.update({where:{id:s.id},data:{lastLogin:new Date}});let o=c().sign({userId:s.id,email:s.email},process.env.JWT_SECRET||"your-secret-key",{expiresIn:"7d"}),{password:l,...p}=s;return n.Z.json({message:"Login successful",user:p,token:o})}catch(e){return console.error("Login error:",e),n.Z.json({error:"Failed to login"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/auth/login/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:f,headerHooks:w,staticGenerationBailout:x}=h,q="/api/auth/login/route";function j(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:v})}},15204:(e,r,t)=>{t.d(r,{_:()=>i});var a=t(53524);let s=globalThis,i=s.prisma??new a.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[3271,8107,6721,2421],()=>t(54128));module.exports=a})();