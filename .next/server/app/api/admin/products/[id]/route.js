"use strict";(()=>{var e={};e.id=6885,e.ids=[6885],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},74072:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>j,patchFetch:()=>k,requestAsyncStorage:()=>w,routeModule:()=>y,serverHooks:()=>P,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>v});var a={};t.r(a),t.d(a,{DELETE:()=>g,GET:()=>h,PUT:()=>m});var o=t(10884),i=t(16132),n=t(21040),u=t(95798),s=t(15204),d=t(96721),c=t.n(d);let p=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production";function l(e){if(!e||!e.startsWith("Bearer "))throw Error("No token provided");let r=e.substring(7);return c().verify(r,p)}async function h(e,{params:r}){try{let t=e.headers.get("authorization");l(t);let a=await s._.product.findUnique({where:{id:r.id},include:{category:!0,images:{orderBy:{sortOrder:"asc"}}}});if(!a)return u.Z.json({error:"Product not found"},{status:404});return u.Z.json({product:a})}catch(e){return console.error("Product fetch error:",e),u.Z.json({error:"Unauthorized"},{status:401})}}async function m(e,{params:r}){try{let t=e.headers.get("authorization");l(t);let a=await e.json(),{name:o,description:i,price:n,originalPrice:d,categoryId:c,stock:p,sku:h,images:m}=a,g=await s._.product.update({where:{id:r.id},data:{name:o,description:i,price:parseFloat(n),originalPrice:d?parseFloat(d):null,categoryId:c,stock:parseInt(p),sku:h},include:{category:!0,images:!0}});return m&&Array.isArray(m)&&(await s._.productImage.deleteMany({where:{productId:r.id}}),m.length>0&&await s._.productImage.createMany({data:m.map((e,t)=>({productId:r.id,url:e.url,altText:e.altText||g.name,isPrimary:0===t,sortOrder:t}))})),u.Z.json({product:g})}catch(e){return console.error("Product update error:",e),u.Z.json({error:"Failed to update product"},{status:500})}}async function g(e,{params:r}){try{let t=e.headers.get("authorization");return l(t),await s._.productImage.deleteMany({where:{productId:r.id}}),await s._.product.delete({where:{id:r.id}}),u.Z.json({success:!0})}catch(e){return console.error("Product deletion error:",e),u.Z.json({error:"Failed to delete product"},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/products/[id]/route",pathname:"/api/admin/products/[id]",filename:"route",bundlePath:"app/api/admin/products/[id]/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/admin/products/[id]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:f,serverHooks:P,headerHooks:x,staticGenerationBailout:v}=y,j="/api/admin/products/[id]/route";function k(){return(0,n.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:f})}},15204:(e,r,t)=>{t.d(r,{_:()=>i});var a=t(53524);let o=globalThis,i=o.prisma??new a.PrismaClient}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[3271,8107,6721],()=>t(74072));module.exports=a})();