"use strict";(()=>{var e={};e.id=2577,e.ids=[2577],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},71758:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>v,originalPathname:()=>k,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>P,staticGenerationBailout:()=>x});var a={};t.r(a),t.d(a,{GET:()=>m,POST:()=>g});var o=t(10884),s=t(16132),i=t(21040),n=t(95798),u=t(15204),c=t(96721),d=t.n(c);let p=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production";function l(e){if(!e||!e.startsWith("Bearer "))throw Error("No token provided");let r=e.substring(7);return d().verify(r,p)}async function m(e){try{let r=e.headers.get("authorization");l(r);let t=new URL(e.url),a=parseInt(t.searchParams.get("page")||"1"),o=parseInt(t.searchParams.get("limit")||"50"),s=t.searchParams.get("search")||"",i=t.searchParams.get("category")||"",c=(a-1)*o,d={};s&&(d.OR=[{name:{contains:s,mode:"insensitive"}},{description:{contains:s,mode:"insensitive"}}]),i&&(d.categoryId=i);let[p,m]=await Promise.all([u._.product.findMany({where:d,include:{category:{select:{id:!0,name:!0}},images:{select:{url:!0,isPrimary:!0},orderBy:{sortOrder:"asc"}}},orderBy:{createdAt:"desc"},skip:c,take:o}),u._.product.count({where:d})]);return n.Z.json({products:p,pagination:{page:a,limit:o,totalCount:m,totalPages:Math.ceil(m/o)}})}catch(e){return console.error("Admin products fetch error:",e),n.Z.json({error:"Unauthorized"},{status:401})}}async function g(e){try{let r=e.headers.get("authorization");l(r);let t=await e.json(),{name:a,description:o,price:s,originalPrice:i,categoryId:c,stock:d,sku:p,images:m}=t;if(!a||!s||!c||void 0===d)return n.Z.json({error:"Missing required fields"},{status:400});let g=await u._.product.create({data:{name:a,description:o||"",price:parseFloat(s),originalPrice:i?parseFloat(i):null,categoryId:c,stock:parseInt(d),sku:p||`SKU-${Date.now()}`},include:{category:!0,images:!0}});return m&&m.length>0&&await u._.productImage.createMany({data:m.map((e,r)=>({productId:g.id,url:e.url,altText:e.altText||g.name,isPrimary:0===r,sortOrder:r}))}),n.Z.json({product:g},{status:201})}catch(e){return console.error("Product creation error:",e),n.Z.json({error:"Failed to create product"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/products/route",pathname:"/api/admin/products",filename:"route",bundlePath:"app/api/admin/products/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/admin/products/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:P,serverHooks:f,headerHooks:v,staticGenerationBailout:x}=h,k="/api/admin/products/route";function w(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:P})}},15204:(e,r,t)=>{t.d(r,{_:()=>s});var a=t(53524);let o=globalThis,s=o.prisma??new a.PrismaClient}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[3271,8107,6721],()=>t(71758));module.exports=a})();