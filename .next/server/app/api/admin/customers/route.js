"use strict";(()=>{var e={};e.id=5436,e.ids=[5436],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},74840:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>A,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>v});var a={};r.r(a),r.d(a,{GET:()=>u,POST:()=>d});var s=r(10884),o=r(16132),i=r(21040),n=r(95798),c=r(15204);async function u(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),a=parseInt(t.get("limit")||"10"),s=t.get("search"),o=t.get("status"),i=t.get("sortBy")||"createdAt",u=t.get("sortOrder")||"desc",d=(r-1)*a,l={};o&&"all"!==o&&(l.isActive="active"===o),s&&(l.OR=[{name:{contains:s}},{email:{contains:s}},{firstName:{contains:s}},{lastName:{contains:s}},{phone:{contains:s}}]);let[m,p]=await Promise.all([c._.user.findMany({where:l,select:{id:!0,email:!0,name:!0,firstName:!0,lastName:!0,phone:!0,isActive:!0,lastLogin:!0,address:!0,city:!0,country:!0,createdAt:!0,updatedAt:!0,_count:{select:{orders:!0,reviews:!0,wishlist:!0}},orders:{select:{total:!0,status:!0,createdAt:!0},orderBy:{createdAt:"desc"},take:1}},orderBy:{[i]:u},skip:d,take:a}),c._.user.count({where:l})]),h=m.map(e=>{let t=e.orders.reduce((e,t)=>e+t.total,0),r=e.orders[0]?.createdAt||null;return{...e,totalSpent:t,lastOrderDate:r,orderCount:e._count.orders,reviewCount:e._count.reviews,wishlistCount:e._count.wishlist}}),g=Math.ceil(p/a);return n.Z.json({customers:h,pagination:{page:r,limit:a,totalCount:p,totalPages:g,hasNext:r<g,hasPrev:r>1}})}catch(e){return console.error("Error fetching customers:",e),n.Z.json({error:"Failed to fetch customers"},{status:500})}}async function d(e){try{let t=await e.json(),{email:r,name:a,firstName:s,lastName:o,phone:i,address:u,city:d,country:l,postalCode:m,password:p="defaultpassword123"}=t,h=await c._.user.create({data:{email:r,name:a||`${s} ${o}`.trim(),firstName:s,lastName:o,phone:i,address:u,city:d,country:l,postalCode:m,password:p,isActive:!0},select:{id:!0,email:!0,name:!0,firstName:!0,lastName:!0,phone:!0,isActive:!0,address:!0,city:!0,country:!0,createdAt:!0}});return n.Z.json({customer:h},{status:201})}catch(e){return console.error("Error creating customer:",e),n.Z.json({error:"Failed to create customer"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/customers/route",pathname:"/api/admin/customers",filename:"route",bundlePath:"app/api/admin/customers/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/admin/customers/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:h,headerHooks:g,staticGenerationBailout:v}=l,A="/api/admin/customers/route";function w(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},15204:(e,t,r)=>{r.d(t,{_:()=>o});var a=r(53524);let s=globalThis,o=s.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[3271,8107],()=>r(74840));module.exports=a})();