"use strict";(()=>{var e={};e.id=4908,e.ids=[4908],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},33380:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>g});var s={};r.r(s),r.d(s,{DELETE:()=>l,GET:()=>d,PUT:()=>c});var o=r(10884),a=r(16132),i=r(21040),n=r(95798),u=r(15204);async function d(e,{params:t}){try{let e=await u._.user.findUnique({where:{id:t.id},include:{orders:{include:{items:!0},orderBy:{createdAt:"desc"}},reviews:{include:{product:{select:{id:!0,name:!0}}},orderBy:{createdAt:"desc"}},wishlist:{include:{product:{select:{id:!0,name:!0,price:!0,images:{take:1}}}}},_count:{select:{orders:!0,reviews:!0,wishlist:!0}}}});if(!e)return n.Z.json({error:"Customer not found"},{status:404});let r=e.orders.reduce((e,t)=>e+t.total,0),s=e.orders.length>0?r/e.orders.length:0,o=e.orders[0]?.createdAt||null,a={...e,totalSpent:r,averageOrderValue:s,lastOrderDate:o,orderCount:e._count.orders,reviewCount:e._count.reviews,wishlistCount:e._count.wishlist};return n.Z.json({customer:a})}catch(e){return console.error("Error fetching customer:",e),n.Z.json({error:"Failed to fetch customer"},{status:500})}}async function c(e,{params:t}){try{let r=await e.json(),{name:s,firstName:o,lastName:a,email:i,phone:d,address:c,city:l,country:m,postalCode:p,isActive:h}=r,w=await u._.user.update({where:{id:t.id},data:{name:s,firstName:o,lastName:a,email:i,phone:d,address:c,city:l,country:m,postalCode:p,isActive:h,updatedAt:new Date},select:{id:!0,email:!0,name:!0,firstName:!0,lastName:!0,phone:!0,isActive:!0,address:!0,city:!0,country:!0,postalCode:!0,createdAt:!0,updatedAt:!0}});return n.Z.json({customer:w})}catch(e){return console.error("Error updating customer:",e),n.Z.json({error:"Failed to update customer"},{status:500})}}async function l(e,{params:t}){try{return await u._.user.delete({where:{id:t.id}}),n.Z.json({message:"Customer deleted successfully"})}catch(e){return console.error("Error deleting customer:",e),n.Z.json({error:"Failed to delete customer"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/customers/[id]/route",pathname:"/api/admin/customers/[id]",filename:"route",bundlePath:"app/api/admin/customers/[id]/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/admin/customers/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:w,headerHooks:f,staticGenerationBailout:g}=m,v="/api/admin/customers/[id]/route";function y(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},15204:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(53524);let o=globalThis,a=o.prisma??new s.PrismaClient}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3271,8107],()=>r(33380));module.exports=s})();