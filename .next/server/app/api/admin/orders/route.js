"use strict";(()=>{var e={};e.id=2402,e.ids=[2402],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61053:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>c});var s=r(10884),n=r(16132),o=r(21040),i=r(95798),u=r(15204);async function d(e){try{let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),a=parseInt(t.get("limit")||"10"),s=t.get("status"),n=t.get("search"),o=t.get("sortBy")||"createdAt",d=t.get("sortOrder")||"desc",c=(r-1)*a,l={};s&&"all"!==s&&(l.status=s),n&&(l.OR=[{orderNumber:{contains:n}},{customerEmail:{contains:n}},{user:{name:{contains:n}}},{user:{email:{contains:n}}}]);let[p,m]=await Promise.all([u._.order.findMany({where:l,include:{user:{select:{id:!0,name:!0,email:!0,firstName:!0,lastName:!0}},items:!0,_count:{select:{items:!0}}},orderBy:{[o]:d},skip:c,take:a}),u._.order.count({where:l})]),g=Math.ceil(m/a);return i.Z.json({orders:p,pagination:{page:r,limit:a,totalCount:m,totalPages:g,hasNext:r<g,hasPrev:r>1}})}catch(e){return console.error("Error fetching orders:",e),i.Z.json({error:"Failed to fetch orders"},{status:500})}}async function c(e){try{let t=await e.json(),{userId:r,customerEmail:a,customerPhone:s,shippingAddress:n,billingAddress:o,items:d,paymentMethod:c,notes:l}=t,p=d.reduce((e,t)=>e+t.price*t.quantity,0),m=.15*p,g=p>500?0:50,h=`ORD-${Date.now()}-${Math.random().toString(36).substr(2,4).toUpperCase()}`,y=await u._.order.create({data:{orderNumber:h,userId:r,customerEmail:a,customerPhone:s,shippingAddress:n,billingAddress:o,subtotal:p,tax:m,shipping:g,total:p+m+g,paymentMethod:c,notes:l,status:"pending",paymentStatus:"pending",items:{create:d.map(e=>({productId:e.productId,name:e.name,sku:e.sku,quantity:e.quantity,price:e.price,total:e.price*e.quantity,image:e.image}))}},include:{user:!0,items:!0}});return i.Z.json({order:y},{status:201})}catch(e){return console.error("Error creating order:",e),i.Z.json({error:"Failed to create order"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/orders/route",pathname:"/api/admin/orders",filename:"route",bundlePath:"app/api/admin/orders/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/admin/orders/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g,headerHooks:h,staticGenerationBailout:y}=l,f="/api/admin/orders/route";function v(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},15204:(e,t,r)=>{r.d(t,{_:()=>n});var a=r(53524);let s=globalThis,n=s.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[3271,8107],()=>r(61053));module.exports=a})();