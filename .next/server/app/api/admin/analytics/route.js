"use strict";(()=>{var e={};e.id=7777,e.ids=[7777],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},89742:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>g,originalPathname:()=>h,patchFetch:()=>_,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{GET:()=>l});var o=a(10884),s=a(16132),n=a(21040),u=a(95798),i=a(15204);async function l(e){try{let{searchParams:t}=new URL(e.url),a=t.get("period")||"30",r=new Date;r.setDate(r.getDate()-parseInt(a));let[o,s,n,l,d,c,m,p,g]=await Promise.all([i._.order.count(),i._.order.aggregate({_sum:{total:!0},where:{status:{in:["delivered","shipped","processing"]}}}),i._.user.count(),i._.product.count(),i._.order.findMany({take:10,orderBy:{createdAt:"desc"},include:{user:{select:{name:!0,email:!0}}}}),i._.order.groupBy({by:["status"],_count:{status:!0},_sum:{total:!0}}),Promise.resolve([]),i._.category.findMany(),Promise.resolve([])]),w=await i._.order.count({where:{createdAt:{gte:new Date(new Date().getFullYear(),new Date().getMonth(),1)}}}),h=await i._.order.count({where:{createdAt:{gte:new Date(new Date().getFullYear(),new Date().getMonth()-1,1),lt:new Date(new Date().getFullYear(),new Date().getMonth(),1)}}}),_=await i._.order.aggregate({_sum:{total:!0},where:{createdAt:{gte:new Date(new Date().getFullYear(),new Date().getMonth(),1)},status:{in:["delivered","shipped","processing"]}}}),D=await i._.order.aggregate({_sum:{total:!0},where:{createdAt:{gte:new Date(new Date().getFullYear(),new Date().getMonth()-1,1),lt:new Date(new Date().getFullYear(),new Date().getMonth(),1)},status:{in:["delivered","shipped","processing"]}}}),v=(D._sum.total||0)>0?((_._sum.total||0)-(D._sum.total||0))/(D._sum.total||0)*100:0,y={overview:{totalOrders:o,totalRevenue:s._sum.total||0,totalCustomers:n,totalProducts:l,ordersGrowth:Math.round(100*(h>0?(w-h)/h*100:0))/100,revenueGrowth:Math.round(100*v)/100,averageOrderValue:o>0?(s._sum.total||0)/o:0},recentOrders:d.map(e=>({id:e.id,orderNumber:`ORD-${e.id.slice(-8).toUpperCase()}`,customer:e.user?.name||e.customerEmail||"Guest Customer",total:e.total,status:e.status,createdAt:e.createdAt,itemCount:1})),ordersByStatus:c.map(e=>({status:e.status,count:e._count.status,revenue:e._sum.total||0})),revenueByMonth:m,topProducts:[],topCategories:p.map((e,t)=>({name:e.name,sales:Math.floor(50*Math.random())+10,percentage:Math.round((30*Math.random()+10)*100)/100})).slice(0,4),customerGrowth:g};return u.Z.json({analytics:y})}catch(e){return console.error("Error fetching analytics:",e),u.Z.json({error:"Failed to fetch analytics"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"/Users/koketsomabuela/alldeals/app/api/admin/analytics/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:p,headerHooks:g,staticGenerationBailout:w}=d,h="/api/admin/analytics/route";function _(){return(0,n.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}},15204:(e,t,a)=>{a.d(t,{_:()=>s});var r=a(53524);let o=globalThis,s=o.prisma??new r.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[3271,8107],()=>a(89742));module.exports=r})();